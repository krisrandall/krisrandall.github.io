<html>
	
	<head>
		
		<link rel="icon" type="image/ico" href="favicon.ico"/>
		<link type="text/css" rel="stylesheet" href="datasync.page.css"/>
		
		<!-- syntax highlighting by : http://alexgorbatchev.com/SyntaxHighlighter/download/ -->
		<script type="text/javascript" src="syntaxhighlighter/scripts/shCore.js"></script>
		<script type="text/javascript" src="syntaxhighlighter/scripts/shBrushJScript.js"></script>
		<script type="text/javascript" src="syntaxhighlighter/scripts/shBrushSql.js"></script>
		<script type="text/javascript" src="syntaxhighlighter/scripts/shBrushPhp.js"></script>
		<link type="text/css" rel="stylesheet" href="syntaxhighlighter/styles/shCoreDefault.css"/>
		<script type="text/javascript">SyntaxHighlighter.all();</script>
		
		<style>
			body {
				padding: 20px;
			}
			h3 {
				margin-top: 50px;
				border-bottom: #222 1px solid;
			}
		</style>
	</head>
	
	
	<body>
		
		
		<h1>
			datasync.js tutorial
			<a href="index.html" style="text-decoration:none;"><img src="resources/Images/logo.png" style="height:50px; width:auto;"/></a>
		</h1>
		<h2>Making your Wordpress site into a phone App</h2>
		<b>
			Part 1 of 3
			(<a href="datasync.js.tutorial-2.html">Part 2</a>,
			<a href="datasync.js.tutorial-3.html">Part 3</a>)
		</b>
		
		<p>
			In this tutorial we are going to create a very simple HTML5 mobile phone app
			that gets it's data from a server on the web and keeps it offline for
			the user to access any time.
			<br/>
		</p>
		<!--
		<p>
			As this is a tutorial, we are going to keep it as bare bones and basic
			as possible.<br/>  If I decide to develop this app furtuer at a later stage
			I may also create further tutorials of the process.<br/>
			Or you can take what is here and develop it further yourself.
		</p>
		-->
		
		<h3>The Concept</h3>
		<p>
			Let's make it something useful.<br/>
			I love when public libraries have
			sales of their books - it is the most fun way, I think, to build up
			your home library.<br/>
			This App will store a listing of libraries and the date(s) they have
			their sales (usually anually).
		</p>
		<p>
			For now lets just store the following information for a library:
			<ul>
				<li>Library ID</li>
				<li>Name</li>
				<li>Address</li>
				<li>Phone Number</li>
			</ul>
			And for the book sales we will store:
			<ul>
				<li>Book Sale ID</li>
				<li>Library ID</li>
				<li>Date of Sale</li>
			</ul>
		</p>
		
		<h3>Step 1. Create the Database</h3>
		<p>
			On your server use <a href="http://www.phpmyadmin.net/home_page/index.php">phpMyAdmin</a> or 
			the <a href="http://dev.mysql.com/doc/refman/5.6/en/mysql.html">MySQL command line</a> to create your 
			database.
			
			<pre class="brush: sql;">
				--
				-- Database: `librarybooksales`
				--
				
				-- --------------------------------------------------------
				
				--
				-- Table structure for table `library`
				--
				
				CREATE TABLE `library` (
				  `id` int(11) NOT NULL AUTO_INCREMENT,
				  `name` varchar(120) COLLATE latin1_general_ci NOT NULL,
				  `address` text COLLATE latin1_general_ci NOT NULL,
				  `phone` varchar(40) COLLATE latin1_general_ci NOT NULL,
				  PRIMARY KEY (`id`)
				) ENGINE=InnoDB DEFAULT CHARSET=latin1 COLLATE=latin1_general_ci AUTO_INCREMENT=1 ;
				
				-- --------------------------------------------------------
				
				--
				-- Table structure for table `booksale`
				--
				
				CREATE TABLE `booksale` (
				  `id` int(11) NOT NULL AUTO_INCREMENT,
				  `library_id` int(11) NOT NULL,
				  `date_of_sale` date NOT NULL,
				  PRIMARY KEY (`id`)
				) ENGINE=InnoDB DEFAULT CHARSET=latin1 COLLATE=latin1_general_ci AUTO_INCREMENT=1 ;				
			</pre>
		</p>
		
		
		<h3>Step 2. Install datasync Server </h3>
		<p>
			<a href="https://github.com/krisrandall/datasync.js/archive/master.zip">Download datasync.js</a> <br/>
			and copy the datasync-server directory to your webserver document root<br/>
			and then edit <i>datasync-server/config.php</i> on your server:
			
			<pre class="brush: php;">
				&lt;?php
				
				// ** App settings - You determine these when you create your app ** //
				
				define('APP_NAME', 'librarybooksales');  				/** Your name for your app */
				define('APP_SECRET_KEY', 'tutorial_secret_pass');   	/** A password you make up */
				
				
				// ** MySQL settings - You can get this info from your web host ** //
				
				define('DB_NAME', 'librarybooksales');				/** The name of the database */
				define('DB_USER', '??????????????');				/** MySQL database username */
				define('DB_PASSWORD', '??????????????');			/** MySQL database password */
				define('DB_HOST', 'localhost');						/** MySQL hostname */
				
				
				
				// ** fetchable_tables is a list of all tables that the client is allow to query ** //
				
				$fetchable_tables = array( 'library', 'booksales' );
				
				
				// ** storeable_tables is a list of all tables that the client is allow to update ** //
				
				$storeable_tables = array(  );
				
				
				?&gt;				
			</pre>
		</p>
		
		
		<h3>Step 3. Create the client App boilerplate </h3>
		<p>
			We will use the mobile app 
			<a href="https://github.com/krisrandall/boilerplate" target="_blank">boilerplate</a>
			which is the best simple and lightweight framework available for HTML5 mobile apps today.<br/>
			<small>
			(There are many others available, such as
			<a href="http://jquerymobile.com/" target="_blank">jQuery mobile</a>,
			<a href="http://ionicframework.com/" target="_blank">ionic</a>,
			<a href="http://lungo.tapquo.com/" target="_blank">Lungo</a>. 
			But <a href="https://github.com/krisrandall/boilerplate" target="_blank">boilerplate</a> is the best.)<br/><br/>
			</small>
			<a href="https://github.com/krisrandall/boilerplate/archive/master.zip">Download boilerplate</a><br/>
			and use it as the base template for your app.<br/>
			Copy the <i>datasync-client</i> directory into that area.<br/>
			<br/>
			You should now have the following files :<br/>
			<img src="resources/templatefiles.png"/>
			<br/>
			<br/>
			You can delete the following :
			LICENSE, README.md, boilerplate.html, and libs/jquery  (we will use the jquery that comes with datasync)
		</p>
		
		
		<h3>Step 4. Generate the <i>mydb.js</i> file</h3>
		<p>
			The <i>mydb.js</i> file is used by datasync.js to replicate your server DB as a local DB in your app.
			<br/>
			You create it by accessing this URL : 
			<a href="#" onClick="alert('You need to go to this file on your server.'); return false;">http://[YOURSERVER.com]/[PATH]/datasync-server/generateClientJS.php</a>
			<br/>
			It should look like this :<br/>
			<pre class="brush: jscript;">
				/**
				 *
				 *  This file is auto generated by datasync-server/generateClientJS.php
				 *  (DB: librarybooksales, DTS: Jun 23 2014 05:39:51 GMT)
				 *
				 *  Save this file with your client app code as datasync-client/mydb.js 
				 *
				**/
				
				
				'use strict';
				
				
				
				// Assume jQuery - this function is the hook where you start your app after the DB is ready
				$(document).ready(function() {
					mydb.thedb.onReady( function() { 
						var event = new CustomEvent('datasync_ready');
						$(document)[0].dispatchEvent(event);
					} );
				});
				
				
				
				// the JayData Database
				
				$data.Entity.extend("control", {
					id: { type: "int", key: true, computed: true }, /* only one record with id=1 */
					DBVersion: { type: "text" },
					lastUpdatedDTS: { type: "text" }
				});
					
				$data.Entity.extend("library", {
					local_id: { type: "int", key: true, computed: true }, 
					id: { type: "int" },
					name: { type: "text" },
					address: { type: "text" },
					phone: { type: "text" }
				});
						
				$data.Entity.extend("booksales", {
					local_id: { type: "int", key: true, computed: true }, 				
			</pre>
			<p>
				Save this file in the <i>datasync-client</i> sub directory of your App directory.
			</p>
		</p>
		
		
		<h3>Step 5. Add <i>datasync.js</i> and <i>mydb.js</i> to your App</h3>
		<p>
			In <i>index.html</i>, add all of the following:
		</p>
		<pre class="brush: jscript;">
			&lt;script src="datasync-client/libs/jquery/jquery.js"&gt;&lt;/script&gt;
			&lt;script src="datasync-client/libs/underscore/underscore.js"&gt;&lt;/script&gt;
			&lt;script src="datasync-client/libs/jaydata/jaydata.js"&gt;&lt;/script&gt;
			&lt;script src="datasync-client/libs/helperlib.js"&gt;&lt;/script&gt;
			&lt;script src="datasync-client/datasync.js"&gt;&lt;/script&gt;
			&lt;script src="datasync-client/mydb.js"&gt;&lt;/script&gt;			
		</pre>
		<p>
			Note that boilerplate already include jquery.js, so the existing one in the index.html from the boilerplate can be removed.
		</p>
		
		<h3><b>Checking</b></h3>
		<p>
			At this point our <i>index.html</i> should look like this :		
		</p>
		<pre class="brush: jscript;">
			&lt;!DOCTYPE &gt;
			
			&lt;html&gt;
				
				&lt;head&gt;
					
					&lt;script src="datasync-client/libs/jquery/jquery.js"&gt;&lt;/script&gt;
					&lt;script src="datasync-client/libs/underscore/underscore.js"&gt;&lt;/script&gt;
					&lt;script src="datasync-client/libs/jaydata/jaydata.js"&gt;&lt;/script&gt;
					&lt;script src="datasync-client/libs/helperlib.js"&gt;&lt;/script&gt;
					&lt;script src="datasync-client/datasync.js"&gt;&lt;/script&gt;
					&lt;script src="datasync-client/mydb.js"&gt;&lt;/script&gt;   
					&lt;script src="libs/transit/js/jquery.transit.min.js"&gt;&lt;/script&gt;
					
							
					&lt;!-- standard App appearance and functionality --&gt;
					&lt;link href="libs/boilerplate/css/boilerplate.css" rel="stylesheet"&gt;	
					&lt;script src="libs/boilerplate/js/boilerplate.js"&gt;&lt;/script&gt;
					
					
				&lt;/head&gt;
				
				
				&lt;body&gt;
			
					&lt;div id="header"&gt;
					&lt;/div&gt;
					
					&lt;div id="main"&gt;
					&lt;/div&gt;
					
					&lt;div id="footer"&gt;
					&lt;/div&gt;
			
					
					
					&lt;!-- if you want an aside hamburger menu --&gt;
					&lt;div id="aside"&gt;
					&lt;/div&gt;
					&lt;!-- end if --&gt;		
					
					
				&lt;/body&gt;
				
				
			&lt;/html&gt;
		</pre>
		
		<p>
			And in the browswer it should show this :
		</p>
		<img src="resources/screenshot1.png"/>
		
		<h2>
			If you have got yours working like this, well done!<br/>
			you are ready to go to 
			<b><a href="datasync.js.tutorial-2.html">Part 2</a></b>
		</h2>
				
	</body>
	
</html>